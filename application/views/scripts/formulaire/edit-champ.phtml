<a href="<?= $this->url(['controller' => 'formulaire', 'action' => 'edit-rubrique', 'rubrique' => $this->champ['ID_RUBRIQUE']], null, true) ?>">
    <i class="icon-arrow-left"></i>
    Retourner sur la rubrique "<?= $this->rubrique['NOM'] ?>"
</a>

<div class="row-fluid">
    <div class="span4">
        <h3>Informations sur la rubrique</h3>
    </div>

    <div class="span6 offset2">
        <h3>Informations sur le champ</h3>
    </div>
</div>

<div id="edit-champ" class="row-fluid">
    <div class="span4 infos-rubrique">
        <h3>
            <?= $this->rubrique['NOM'] ?>
            <?php if($this->rubrique['DEFAULT_DISPLAY']): ?>
                <small>(Affichée par défaut)</small>
            <?php endif ?>
        </h3>
    </div>

    <div class="span4 offset2 infos-champ">
        <form action class="form-inline" method="post">
            <div class="row-fluid">
                <label for="nom_champ">Nom du champ</label>
                <input type="text" name="nom_champ" id="nom_champ" value="<?= htmlspecialchars($this->champ['NOM'], ENT_QUOTES) ?>" required>
            </div>
            <div class="row-fluid">
                <label for="type_champ">Type du champ</label>
                <select name="type_champ" id="type_champ" disabled>
                    <?php foreach($this->listeTypeChampRubrique as $typeChamp): ?>
                        <option
                            value="<?= $typeChamp['ID_TYPECHAMP'] ?>"
                            <?= $typeChamp['ID_TYPECHAMP'] === $this->champ['ID_TYPECHAMP'] ? 'selected' : '' ?>
                        >
                            <?= $typeChamp['TYPE'] ?>
                        </option>
                    <?php endforeach ?>
                </select>
            </div>

            <?php if($this->valeursChamp !== null): ?>
                <!-- Valeurs de la liste -->
                <div class="row-fluid">
                    <h3>Valeurs de la liste</h3>
                    <?php foreach($this->valeursChamp as $valeur): ?>
                        <div>
                            <input type="text" name="valeur-champ-<?= $valeur['ID_VALEURLISTE'] ?>" value="<?= htmlspecialchars($valeur['VALEUR'], ENT_QUOTES) ?>">
                            <a href='#' data-id="<?= $valeur['ID_VALEURLISTE'] ?>" class="delete-list-value">Supprimer</a>
                        </div>
                    <?php endforeach ?>

                    <div id="div-valeurs-liste">
                        <div class="row-fluid">
                            <a href='#' id='add-list-value'>Ajouter une valeur</a>
                        </div>
                        <div class="row-fluid">
                            <div id="valeurs-liste" class="span10">
                            </div>
                        </div>
                    </div>
                </div>
            <?php endif ?>


            <div class="pull-right">
                <a href="<?= $this->url(['controller' => 'formulaire', 'action' => 'edit-rubrique', 'rubrique' => $this->champ['ID_RUBRIQUE']], null, true) ?>"" type="button" class="btn">Annuler</a>
                <button type="submit" class="btn btn-success">Sauvegarder le champ</button>
            </div>
        </form>
    </div>
</div>

<?= $this->partial('formulaire/partials/champ/partial-add-and-list-titles.phtml', [
    'count' => count($this->listChamp),
    'titleInfo' => 'Informations sur le champ enfant',
    'titleList' => 'Liste des champs enfants',
]); ?>

<div class="row-fluid span3 infos-champ">
    <?php if ($this->type === 'Parent') : ?>
        <form enctype="application/x-www-form-urlencoded" method="post" class="form-inline" action>
            <!-- FIXME Div inutile ? -->
            <div class = 'flexCol'>
                <?= $this->formChamp->nom_champ ?>
                <?= $this->formChamp->type_champ ?>
                <?= $this->formChamp->ID_CHAMP_PARENT ?>
                <?= $this->formChamp->rubrique ?>
                <div id="div-list-value">
                    <h5>Définition des valeurs de la liste</h5>
                    <div class="row-fluid">
                        <a href='#' id='add-list-value'>Ajouter une valeur</a>
                    </div>
                    <div class="row-fluid">
                        <div id="list-value" class="span10">
                        </div>
                    </div>
                </div>
            </div>

            <?= $this->formChamp->save ?>
        </form>

        <table class="table table-bordered table-condensed inline">
            <thead>
                <tr>
                    <th>Nom du champ</th>
                    <th>Type du champ</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id='tableParentChamp'>
                <?php foreach($this->listChamp as $champ) :?>
                    <tr>
                        <td><?= $champ['NOM'] ?></td>
                        <td><?= $champ['TYPE'] ?></td>
                        <td id='actions'>
                            <div class='text-center'>
                                <a href="<?= $this->url(['controller' => 'formulaire', 'action' => 'edit-champ', 'rubrique' => $this->rubrique['ID_RUBRIQUE'], 'champ' => $champ['ID_CHAMP']], null, true) ?>">
                                    <i title='Modifier' class='icon-pencil'></i>
                                </a>
                                <a href="<?= $this->url(['controller' => 'formulaire', 'action' => 'delete-champ', 'rubrique' => $this->rubrique['ID_RUBRIQUE'], 'champ' => $champ['ID_CHAMP'], 'ID_PARENT' => $champ['ID_PARENT']], null, true) ?>">
                                    <i title='Supprimer' class='icon-trash'></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                <?php endforeach ?>
            </tbody>
        </table>
    <?php endif ?>
</div>
